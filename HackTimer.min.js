// ==UserScript==
// @name        HackTimer
// @namespace   https://github.com/turuslan/HackTimer
// @version     1.0.0
// @author      turuslan
// @description Avoid timers throttling by browser when tab is inactive
// @license     MIT
// @include     *
// @grant       unsafeWindow
// @run-at      document-start
// ==/UserScript==
!function(t){try{var e=new Blob(["var fakeIdToId = {};onmessage = function (event) {\tvar data = event.data,\t\tname = data.name,\t\tfakeId = data.fakeId,\t\ttime;\tif(data.hasOwnProperty('time')) {\t\ttime = data.time;\t}\tswitch (name) {\t\tcase 'setInterval':\t\t\tfakeIdToId[fakeId] = setInterval(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearInterval':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearInterval(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t\tcase 'setTimeout':\t\t\tfakeIdToId[fakeId] = setTimeout(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t\t}\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearTimeout':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearTimeout(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t}}"]);t=window.URL.createObjectURL(e)}catch(t){console.error("Blob is not supported",t)}var a,o={},r=0,n="[IGIFTMSG] HackTimer";if("undefined"!=typeof Worker){function d(){do{2147483647==r?r=0:r++}while(o.hasOwnProperty(r));return r}try{a=new Worker(t),window.setInterval=function(t,e){var r=d();return o[r]={callback:t,parameters:Array.prototype.slice.call(arguments,2)},a.postMessage({name:"setInterval",fakeId:r,time:e}),r},window.clearInterval=function(t){o.hasOwnProperty(t)&&(delete o[t],a.postMessage({name:"clearInterval",fakeId:t}))},window.setTimeout=function(t,e){var r=d();return o[r]={callback:t,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},a.postMessage({name:"setTimeout",fakeId:r,time:e}),r},window.clearTimeout=function(t){o.hasOwnProperty(t)&&(delete o[t],a.postMessage({name:"clearTimeout",fakeId:t}))},a.onmessage=function(t){var e,a,r,d=t.data.fakeId;if(o.hasOwnProperty(d)&&(r=(e=o[d]).callback,a=e.parameters,e.hasOwnProperty("isTimeout")&&e.isTimeout&&delete o[d]),"string"==typeof r)try{r=new Function(r)}catch(t){console.log(n+"Error parsing callback code string: ",t)}"function"==typeof r&&r.apply(window,a)},a.onerror=function(t){console.log(t)}}catch(t){console.log(n+"Initialisation failed"),console.error(t)}}else console.log(n+"Initialisation failed - HTML5 Web Worker is not supported")}("HackTimerWorker.js");